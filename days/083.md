# Troubleshoot and Create Ansible Playbook

An Ansible playbook needs completion on the jump host, where a team member left off. Below are the details:

- The inventory file `/home/thor/ansible/inventory` requires adjustments. The playbook must run on App Server 2 in Stratos DC. Update the inventory accordingly.

- Create a playbook `/home/thor/ansible/playbook.yml`. Include a task to create an empty file `/tmp/file.txt` on App Server 2.

> Note: Validation will run the playbook using the command ansible-playbook -i inventory playbook.yml. Ensure the playbook works without any additional arguments.

## Steps

0. Move into ansible directory:

    ```sh
    cd ansible
    ls
    ```

1. Fix the inventory file:

    ```ini
    stapp02 ansible_host=172.238.16.204 ansible_user=steve ansible_ssh_common_args='-o StrictHostKeyChecking=no'
    ```

    > The host is not the correct one for app server 2. replace host ip with hostname of app server 2: `stapp02` and add `ansible_ssh_password`

    ```ini
    stapp02 ansible_host=stapp02 ansible_user=steve ansible_ssh_password=Am3ric@ ansible_ssh_common_args='-o StrictHostKeyChecking=no'
    ```

2. Create a playbook.yml file and copy-paste contents from [this playbook file](../files/ansible-simple-playbook-83.yaml)

3. Run the playbook command:

    ```sh
    ansible-playbook -i inventory playbook.yml
    ```

## Good to Know?

### Ansible Troubleshooting

- **Connection Issues**: Verify SSH connectivity and credentials
- **Inventory Problems**: Check host definitions and variables
- **Module Errors**: Validate module syntax and parameters
- **Permission Issues**: Ensure proper sudo/root access

### Common Issues

- **Host Unreachable**: Network connectivity problems
- **Authentication Failed**: Wrong credentials or SSH keys
- **Module Not Found**: Missing Ansible modules
- **Syntax Errors**: YAML formatting issues

### Debugging Techniques

- **Verbose Mode**: Use `-v`, `-vv`, `-vvv` for detailed output
- **Check Mode**: Use `--check` for dry-run execution
- **Limit Hosts**: Use `--limit` to target specific hosts
- **Step Mode**: Use `--step` for interactive execution

### File Operations

- **file Module**: Create, modify, delete files and directories
- **copy Module**: Copy files from control node to managed nodes
- **template Module**: Process Jinja2 templates
- **lineinfile Module**: Modify specific lines in files
